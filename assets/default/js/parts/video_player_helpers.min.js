/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!****************************************************!*\
  !*** ./resources/js/parts/video_player_helpers.js ***!
  \****************************************************/
var fileVideoPlayer;

/**
 * Generates Plyr-compatible HTML, including a wrapper.
 */
window.makeVideoPlayerHtml = function (path, storage, height, tagId) {
  var html = '';

  // For YouTube and Vimeo, create the Plyr div structure inside a wrapper
  if (storage === 'youtube' || storage === 'vimeo') {
    var videoId = path.split('/').pop().split('?')[0]; // Extracts video ID from URL

    // The wrapper for positioning context
    // -->> MODIFIED: Added inline style for min-height
    html = '<div class="player-wrapper" style="">' +
           '<div id="' + tagId + '" data-plyr-provider="' + storage + '" data-plyr-embed-id="' + videoId + '"></div>' +
           '</div>';
  }
  // For secure_host, we still use an iframe (no wrapper needed)
  else if (storage === "secure_host") {
    // -->> MODIFIED: Added inline style for width, min-height, and border
    html = '<iframe src="' + path + '" style="width: 100%;  border: 0;" class="img-cover bg-gray200" frameborder="0" allowfullscreen="true" ></iframe>';
  }
  // For local files, create the standard video tag inside a wrapper
  else {
    // Add the outer wrapper for consistency
    // -->> MODIFIED: Added inline style for min-height
    html = '<div class="player-wrapper" style="">' +
           '<video id="' + tagId + '" oncontextmenu="return false;" controlsList="nodownload" playsinline controls width="100%">' + // <-- الطول الثابت محذوف
           '<source src="' + path + '" type="video/mp4"/>' +
           '</video>' +
           '</div>';
  }

  return {
    html: html
  };
};

window.handleVideoByFileId = function (fileId, $contentEl, callback) {
  closeVideoPlayer();
  var height = $(window).width() > 991 ? 426 : 264;

  $.post('/course/getFilePath', {
    file_id: fileId
  }, function (result) {
    if (result && result.code === 200) {
      var storage = result.storage;
      var videoTagId = 'videoPlayer' + fileId;
      var html = makeVideoPlayerHtml(result.path, storage, height, videoTagId).html;

      $contentEl.html(html);

      if (storage !== "secure_host") {
        // -->> MODIFIED: Added seekTime and updated the controls array
        fileVideoPlayer = new Plyr('#' + videoTagId, {
          seekTime: 10, // Set seek time to 10 seconds
          youtube: {
            controls: 0,
            disablekb: 1,
            modestbranding: 1
          },
          controls: [
            'play-large',
            'rewind', // Added rewind button
            'play',
            'fast-forward', // Added fast-forward button
            'progress',
            'current-time',
            'mute',
            'volume',
            'captions',
            'settings',
            'pip',
            'airplay',
            'fullscreen'
          ]
        });

        fileVideoPlayer.on('ready', function(event) {
          var instance = event.detail.plyr;
          if (instance.isYouTube) {
            var overlay = document.createElement('div');
            overlay.className = 'plyr__video-overlay';
            instance.elements.container.appendChild(overlay);

            // ## الكود الجديد: إضافة ميزة النقر للتشغيل/الإيقاف ##
            // عند النقر على الطبقة الواقية
            overlay.addEventListener('click', function() {
              // قم بتشغيل الفيديو إذا كان متوقفاً، أو إيقافه إذا كان يعمل
              instance.togglePlay();
            });
            // ## نهاية الكود الجديد ##
          }
        });

      }
      callback();
    } else {
      $.toast({
        heading: notAccessToastTitleLang,
        text: notAccessToastMsgLang,
        bgColor: '#f63c3c',
        textColor: 'white',
        hideAfter: 10000,
        position: 'bottom-right',
        icon: 'error'
      });
    }
  }).fail(function (err) {
    $.toast({
      heading: notAccessToastTitleLang,
      text: notAccessToastMsgLang,
      bgColor: '#f63c3c',
      textColor: 'white',
      hideAfter: 10000,
      position: 'bottom-right',
      icon: 'error'
    });
  });
};

window.closeVideoPlayer = function () {
  // Plyr uses .destroy() instead of .dispose()
  if (fileVideoPlayer && typeof fileVideoPlayer.destroy === 'function') {
    fileVideoPlayer.destroy();
  }
};

window.pauseVideoPlayer = function () {
  if (fileVideoPlayer && typeof fileVideoPlayer.pause === 'function') {
    fileVideoPlayer.pause();
  }
};
/******/ })()
;
